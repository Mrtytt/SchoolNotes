## Virtual Memory
- Programın çalışması için tüm program gerekli olmayabilir.
- Parçalı bir şekilde çalışmasının faydaları vardır.
	- Hafızadan fazla bir alan isteyebilir.
	- Küçük parçalara bölündüğü için çok sayıda program eş zamanlı çalıştırılabilir.
- Sanal bellek, hafıza alanı limitini ortadan kaldırır. Fiziksel hafızadan çok büyük bir alan sağlar.
- Sanal bellek adresinin fiziksel adrese dönüştürülmesi gerekir.
- Process'ler için *page table* fiziksel hafızada saklanır.
- Heap ve stack'ler dinamik olarak boyutları artabilir.
### Demand Paging
- Yaygın olarak kullanılan bir yöntemdir.
- Kullanılmayan sayfalar hafızaya yüklenmez. Sadece gerekli sayfalar yüklenir.
	- Böylece hafıza alanı ve swap süresi kısaltılır. (Lazy Swapper)
- Swapping işlemleri ile page'leri yönetir.
- Swap-in olduğu zaman pager, hangi sayfaların kullanılacağını tahmin eder.

- Hafızada mı diskte mi olduğunu tutmak için donanımsal bileşen gerekir.
- Valid ve invalid şeklinde bir bit sayfanın bulunduğunu yeri (olup olmadığını) belirlemek için kullanılır.
#### Page Fault
- Invalid bir sayfaya erişime *page fault (sayfa hatası)* denir. İşletim sistemi sayfayı hafızaya aktarır. Aktarırıken boş bir frame arar, bunun için page table'a bakar. Daha sonra *invalid -> valid* olur. Bu işlem vakit alır.
- Frame seçici algortimalar bulunur. Ancak bu hem zaman hem de maliyet gerektirir o yüzden kullanılmaz.
- Process ilk kez çalıştırıldığında hiçbir sayfa hafızada olmayabilir. Hemen bir page fault üretilir.
- Bir page'in ihtiyaç duyulmadığı sürece hafızaya alınmamasına *pure demand paging* denir.
- Bazı programlar birden çok sayfaya erişebilir bu da çok sayıda page fault oluşmasına sebep olur.
- Demand paging performansı önemli ölçüde etkiler.
- *Page Fault* hiç oluşmadığı zaman erişim süresi hafızaya erişim süresine eşittir.
### Copy-on-write
- fork() ile bir child process (parent process'in kopyası) oluşturulur.
- Child process parent process'in sahip olduğu tüm sayfalara ihtiyaç duyulmayabilir.
- Bir page üzerinde değişiklik yapılacağında kopyaları oluşturulur. (*copy-on-write*)
### Page Replacement
%%ÖNEMLİ%%
- İlk çağırımda page fault oluşur.
- Processlerin çalışması sırasında genellikle page'lerin yarısı kullanılır. Ancak hepsini de kullanmak da isteyebilir.
	- Bu yüzden, deman paging I/O gereksinimini azaltır.
- Multiprogramming ile daha çok process'i çalıştırabiliriz.
- OS yeni bir sayfa için mevcut sayfalardan birisini swap out yapabilir. Buna *Page Replacement* denir.
- Temel algoritma
	- Eğer boş frame yoksa o an kullanılmayan bir frame seçilir ve swap out yapılır.
	- Swap out yapılan frame için page table invalid yapılır.
		- Disk üzerinden bulunur.
		- Boş frame varsa, bu frame kullanılır.
		- Yoksa, page-replacement algoritması ile bir frame seçilerek kullanılır.
		- Seçilen frame disk'e yazılır ve page table değiştirilir.
	- Disk'te istenen sayfa okunarak bu fram'e yazılır.
	- ...

	- Page fault olması hainde boş frame yoksa iki kez page fault kadar beklenir. (SI,SO)
	- Hafızada kaldığı süreçte değişmeyen sayfalar yazılmaz.
	- Her sayfa için bir modify bit (dirty bit) ile değişip değişmediği tutulur.
#### FIFO Page Replacement
- İlk gelen frame atılarak yeni gelen frame buraya yazılır.
- Seçilen sayfa aktif kullanılıyorsa swap out yapılması uygun değildir. O sayfa için tekrar bir page fault oluşur.
- Daha fazla frame ayrılması halinde daha fazla page fault oluşur. (*Belody's Anomaly*)
#### Optimal Page Replacement
- En uzun süre kullanılmayacak sayfa ile yer değiştime yapılır.
- Daha geç lazım olacak page swap-out yapılır.
- İleriye doğru bakılır.
#### LRU Page Replacement
- En uzun süredir kullanmadığımızı atıyoruz.
- Kullanılmama süresini tutmak için counter kullanılabilir.
- Kullanılan sayfa stack kullanılarak her defasında top eleman yapılır.
- Geriye doğru bakılır.
#### Counting Based Page Replacement
- Her sayfanın kullanılmasıklığını tutularak yer değiştirme yapılır.
- LFU ve MFU bulunur. LFU en az kullanılanı,MFU en çok kullanılanı swap out yapar.
### Allocation of Frames
- Her process için ayrılacak frame sayısı page fault oranı için önemlidir.
- Bir process'e daha fazla atanmaz , minimum ataanır.
- Bir frame; instruction (komut) için bir frame'de data (veri) için gerekir.
- Daha az tahsis edilirse page fault oluşur.
#### Global Veya Lokale Atama


